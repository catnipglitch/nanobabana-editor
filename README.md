---
title: nanobanana-editor
emoji: 🤖
colorFrom: indigo
colorTo: blue
sdk: gradio
sdk_version: 5.50.0
app_file: app.py
python_version: 3.11
pinned: false
---


# nanobanana-editor

Google Gen AI SDK for Python を使用した画像生成ツール

## 概要

GeminiとImagenモデルによるAI画像生成ツールです。ブラウザベースの直感的なUIで、テキストや参照画像から画像を生成できます。

## インストール

### 必要要件

- Python 3.11以上（ローカル開発では3.13推奨、Hugging Face Spacesでは3.11）
- Google API キー（Gemini Developer API）

### セットアップ手順

#### 1. uvのインストール

```bash
# macOS / Linux
curl -LsSf https://astral.sh/uv/install.sh | sh

# Windows (PowerShell)
powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"
```

#### 2. 依存関係のインストール

```bash
uv sync
```

#### 3. 環境変数の設定

プロジェクトルートに `.env` ファイルを作成：

```bash
GOOGLE_API_KEY=your-api-key
```

詳細は `.env.example` を参照してください。

## 起動方法

### Gradio UI（推奨）

```bash
# 仮想環境を有効化
source .venv/bin/activate  # Linux/macOS
.venv\Scripts\activate     # Windows

# 起動
python app.py

# または、テストモード（APIキー不要）
python app.py --test
```

起動後、ブラウザで `http://localhost:7860` にアクセスします。

## 機能一覧（11タブ構成）

### Tab 1: 画像生成（Gemini）✅
Geminiモデルによる高速な画像生成。プロンプトから1枚ずつ生成。

**主要機能:**
- プロンプト最適化（レベル0/1/2）: Gemini 3.0による自動プロンプト改善
- プロンプトプレビュー: 生成前に最適化されたプロンプトを確認・編集可能
- Google検索ツール: リアルタイム情報取得（Gemini 3 Pro Image推奨）
- テンプレート選択: サンプルプロンプトから選択

### Tab 2: ベーシック編集 ✅
入力画像（1枚）をベースにした画像編集タブ。テンプレートとプロンプト最適化を活用して、スタイル変更やアップスケールなどを行います。

**主要機能:**
- テンプレート選択: `image_edit` カテゴリのテンプレートから処理を選択
- プロンプト最適化（レベル1-3）: 入力画像の文脈を含めた高度なプロンプト生成
- プロンプトプレビュー: 生成前に最適化されたプロンプトを確認・編集可能
- Google検索ツール: リアルタイム情報取得（Gemini 3 Pro Image推奨）
- 柔軟なアスペクト比・解像度設定（1K/2K/4K）

### Tab 3: 参照画像ベース生成 ✅
最大14枚の参照画像とプロンプトから新しい画像を生成。Gemini 3 Pro Image Previewを使用。

### Tab 4: マルチターン編集 ✅
対話形式での段階的な画像編集。アルファチャンネル切り抜き・背景除去などの処理に対応。

**主要機能:**
- マルチターン処理: 1ターン目で編集、2ターン目でアルファマット生成
- プロンプト最適化（レベル0/1/2）: Gemini 3.0による追加指示の最適化
- プロンプトプレビュー: 生成前に最適化されたプロンプトを確認・編集可能
- 処理タイプ選択: ポーズ維持型・アップスケールなど複数の処理パターン

### Tab 5: レイアウト編集 🚧
キャラクターシートなど定型レイアウトでの画像配置。

### Tab 6: 衣装チェンジ 🚧
キャラクター着替え専用機能。マスク処理による部分的な画像変更。

### Tab 7: 高度な編集 🚧
アルファチャンネル処理・高度なマスク編集など。

### Tab 8: 画像解析 🚧
画像説明生成・ポーズ抽出・オブジェクト検出。Gemini Visionを使用。

### Tab 9: Chat / エージェント ✅
対話型エージェントによる編集支援。

### Tab 10: 画像生成（Imagen）✅
Imagenモデルによる高品質な画像生成。複数枚の一括生成や詳細なパラメータ調整が可能。

### Tab 11: Settings ✅
APIキーの管理と接続テスト。アプリ起動時にAPIキー未設定の場合は自動的にこのタブが表示されます。

> **凡例**: ✅ 実装済み / 🚧 Coming Soon

## 対応モデル

### Gemini
- `gemini-2.5-flash-image` - 高速生成
- `gemini-3-pro-image-preview` - 参照画像ベース生成

### Imagen
- `imagen-4.0-generate-001` - 最新高品質
- `imagen-4.0-fast-generate-001` - 最新高速
- `imagen-4.0-ultra-generate-001` - 最新最高品質
- `imagen-3.0-generate-002` - 推奨
- `imagen-3.0-generate-001`
- `imagen-3.0-fast-generate-001` - 高速
- `imagen-3.0-capability-001` - 高機能

### Test Model
- `test-model` - APIキー不要のテストモデル（開発・デバッグ用）

## 出力ファイル

### ローカル環境

生成されたファイルは `output/` ディレクトリに保存されます。

**ファイル命名規則（単一画像）:**
```
{prefix}_{YYYYMMDDHHMMSS}_{unique_id}.png
{prefix}_{YYYYMMDDHHMMSS}_{unique_id}.json
```

**ファイル命名規則（複数画像）:**
```
{prefix}_{YYYYMMDDHHMMSS}_{unique_id}_0.png
{prefix}_{YYYYMMDDHHMMSS}_{unique_id}_1.png
{prefix}_{YYYYMMDDHHMMSS}_{unique_id}.json
```

**メタデータ:**

各画像に対応するJSONファイルには以下の情報が保存されます:
- タイムスタンプ
- 画像ファイル名
- 使用モデル
- プロンプト
- 生成パラメータ
- 認証方式

### Hugging Face Spaces

クラウド環境では、ストレージがephemeral（一時的）なため、ファイル保存は自動的に無効化されます。

- 画像はGradioの一時ファイル機構で管理
- UIに「保存無効」メッセージを表示
- メタデータはJSON表示コンポーネントで確認可能
- ユーザーは表示された画像を個別にダウンロード可能

**環境検出:** `SPACE_ID` 環境変数の存在により自動判定されます。

## トラブルシューティング

### APIキーエラー

```
❌ エラー: GOOGLE_API_KEYが設定されていません
```

→ `.env`ファイルに`GOOGLE_API_KEY`を設定してください

```bash
GOOGLE_API_KEY=your-api-key
```

### Test Modelを使用したい

APIキー不要で動作確認が可能です:

```bash
# CLI
python generate_image.py "Test prompt" -m test-model

# Gradio UI
# Tab 1またはTab 2からモデル選択で "Test Model" を選択
```

## 共通機能の説明

このセクションでは、複数のタブで共通して使用される機能について説明します。

### プロンプト最適化とは？

**概要:**
プロンプト最適化は、ユーザーが入力したプロンプトをGemini AIが自動的に改善・拡張する機能です。より具体的で詳細な指示に変換することで、画像生成の品質を向上させます。

**4つの最適化レベル:**

- **レベル0: 無効（整合性チェックのみ）**
  - 入力プロンプトをそのまま使用します
  - LLM呼び出しなし、システムプロンプトとの単純結合のみ
  - 使用シーン: プロンプトを完全にコントロールしたい場合

- **レベル1: 修正のみ（誤字脱字・語順）（推奨）** ⭐ NEW
  - Gemini 2.0 Flashが誤字脱字や不自然な語順のみを修正します
  - プロンプトの意味や内容は変更しません
  - 高速・低コストで動作
  - 使用シーン: 通常の画像生成（最も推奨）

- **レベル2: 標準最適化**
  - Gemini 3.0 Proがプロンプトを自動的に改善します
  - 欠けている情報を補完し、曖昧な表現を具体化
  - 使用シーン: より詳細な最適化が必要な場合

- **レベル3: 創造的拡張**
  - Gemini 3.0 Proがプロンプトを視覚的に豊かな表現に拡張します
  - より印象的で創造的な結果を生成
  - 使用シーン: アーティスティックな表現が必要な場合

**2つの実行方法:**

1. **「最適化プロンプト生成」ボタン**
   - 最適化されたプロンプトをプレビューできます
   - 生成前に内容を確認・手動編集が可能
   - 推奨ワークフロー: プレビュー → 確認/編集 → 画像生成

2. **直接「画像生成開始」または「編集開始」ボタン**
   - プロンプト最適化と画像生成を一度に実行
   - より迅速な生成が可能
   - 最適化結果は生成後に確認可能

**強化された自動変換機能 (Level 1-3):**

- **ファイル名変換:** 
  プロンプト内のファイル名（例: "cat.jpg"）を、AIが理解できる順序指定（例: "1番目の画像"）に自動変換します。これにより、複数の参照画像を使用する際に、どの画像に対する指示かを明確にできます。
  
- **時勢表現の具体化:**
  "明日"、"先週" といった相対的な時間表現を、生成時点の日時を基準とした絶対的な日付（例: "2025年12月1日"）に変換します。これにより、季節やイベントに関連する生成の精度が向上します。

- **多言語対応:**
  日本語と英語のプロンプトに対応し、選択された言語モードに合わせて最適化を行います。

**背景:**
Gemini AIは高度な言語理解能力を持つため、ユーザーの意図を解釈して最適なプロンプトを生成できます。この機能により、プロンプトエンジニアリングの知識がなくても高品質な画像を生成できます。

---

### ツールオプション: Google Search とは？

**概要:**
Google Search は、画像生成時にリアルタイムのインターネット情報を取得する機能です。Gemini 3 Pro Image Preview モデルで利用可能です。

**機能の仕組み:**
1. プロンプト内にリアルタイム情報が必要な指示が含まれている場合（例: 「東京の最新の天気」「今日の日付」）
2. Gemini APIがGoogle検索を実行して最新情報を取得
3. 取得した情報をプロンプトに反映して画像を生成

**使用シーン:**

- **天気予報の画像生成**: 実際の天気データを反映
- **ニュース関連の画像**: 最新のイベント情報を取得
- **日付・時刻が重要な場合**: 現在の正確な日時を反映
- **リアルな背景情報**: 実在する場所の現在の状態を反映

**使用例:**

```
プロンプト: 「渋谷スクランブル交差点での天気予報番組の生中継。
現在の天気と3日間の予報を表示するパネルを持つキャスター」

Google Search有効時:
→ 実際の渋谷の天気予報データを取得
→ 正確な日付・曜日・気温を反映した画像を生成

Google Search無効時:
→ 架空の天気データで画像を生成
→ 日付や気温は不正確
```

**注意事項:**
- この機能は追加のAPI呼び出しを伴うため、生成時間が若干長くなる場合があります
- プロンプトに明示的にリアルタイム情報の取得を指示する必要があります（例: "Use Google Search to reflect real-world information"）
- Gemini 3 Pro Image Preview モデルでの使用を推奨

**どのような時に有効化するか:**
- ✅ リアルタイムデータが必要な場合（天気、日時、最新ニュース）
- ✅ 実在する場所や人物の最新情報が必要な場合
- ❌ 架空のシーンやキャラクターを生成する場合
- ❌ 生成速度を最優先する場合

---

## 技術スタック

- **Python**: 3.11以上（ローカル: 3.13推奨、HF Spaces: 3.11）
- **Google Gen AI SDK for Python**: 統合APIクライアント
- **Gradio**: WebUIフレームワーク
- **PIL (Pillow)**: 画像処理



## ライセンス

このプロジェクトは個人利用を想定しています。
